# 断点 + mmap 传输

- 文件传输流程（注：发送方简写为FS，接收方简写为JS，不完整文件加后缀.inc）
  - **FS发送文件名小火车**，《*JS检测接收是否有重名文件*》
    - 若存在该文件名，《*JS发送"文件已存在"字符串小火车*》，**FS接受小火车显示文件已存在，停止传输**
    - 若存在该文件名 + .inc，《*JS首先发送"文件不完整"字符串小火车，再发送.inc文件大小*》，**FS接受第一个小火车显示文件不完整，并从第二个小火车取出文件大小（n），令"dataLength = n"**
    - 若不存在该文件文件名，《*JS发送"文件不存在"字符串小火车，发送方接受小火车显示文件不存在*》，**FS令"dataLength = 0"**
  - FS检测（fileSize - n >= 100M ?）
    - 若大于等于，**FS则采用mmap传输（分批发送），FS从fileName.inc的n处开始传输**
    - 若小于，**FS直接采用原始方法传输，只不过这里FS开始传输之前需要将read指针调至n处**
    - 《*JS端不采用mmap，采用原始方法进行接收，JS要将write指针调至n处*》
  - 《*JS接收完毕将fileName.inc修改为fileName*》





